B問題

まず、a1 + a2 + ... + aN = K のときは、すべての日のすべてのゲームに勝つことになります。
この場合、1 日目以降の勝率はすべて 1 であり、勝率が上がった回数は 1 です。
この場合は特別に処理することにして、以下そうでない場合のみ考えます。


勝利回数を K 回ちょうどでなく、K 回以下と言い換えても答えが変わらないことを証明します。
L(< K < a1 + ... + aN ) 回の勝利回数で t 回、前日までより勝率が上がったとします。
このとき、勝利回数の列を後ろから順に見て、勝利回数が K 回に達するまで、
その日のゲームの回数より勝利回数が真に少ない日の勝利回数を増やす操作を考えます。

この操作で勝利回数が増えた (前から見て) 最初の日を x 日目とします。
x + 1 日目以降はすべてのゲームに勝っており、
x − 1 日目までに (場合分けの条件より) 少なくとも 1 敗はしていることから、
x + 1 日目以降のすべての日で勝率が上がっています。
また、x 日目にはこの操作のせいで勝率が下がるようになることはなく、
x − 1 日目以前の勝率の上下は、この操作では変わりません。
よって、L 回の勝利で t 回勝率が上昇する状況が存在するなら、
K 回の勝利で t 回以上勝率が上昇する状況も存在することが示されました。

ここで、以下のような DP を考えます。
DP[i][j] を i 日目までに j 回勝率が上昇した場合の勝利数の最小値とします。
この DP の遷移は、i 日目の勝利回数として 0 から ai までの ai + 1 通りが考えられますが、勝利数を最小化したいので、
この中の 0 勝の場合と、勝率が上昇するぎりぎりの勝ち数の場合だけ遷移をすればいいことが分かります。
この DP を計算していき、DP[N][i] が K 以下となる最大の i が求める答えとなります。
これで時間計算量は O(N2) となり、正答を得ることができます。
実装によっては a1 = 1 の場合がコーナーケースとなるので、気を付けましょう。